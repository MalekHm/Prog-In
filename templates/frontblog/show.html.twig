{% extends 'base.html.twig' %}


{% block content %}
    <!-- Home -->

    <div class="home">
        <div class="home_background parallax-window" data-parallax="scroll" data-image-src="{{ asset('front/images/blog_background.jpg') }}"></div>
        <div class="home_content">
            <div class="home_title">the blog</div>
        </div>
    </div>

    <!-- Blog -->

    <div class="blog">
        <div class="container">
            <div class="row">

                <!-- Blog Content -->
                <div class="col-lg-8">

                    <div class="blog_post_container">

                        <!-- Blog Post -->


                        <!-- Blog Post -->


                        <!-- Blog Post -->

                        <div class="blog_post">
                            <div class="blog_post_image">
                                <img src="{{ asset('uploads/images/' ~ blog.picture) }}" alt="https://unsplash.com/@stilclassics">
                                
                                </div>
                            </div>
                            <div class="blog_post_meta">
                                <ul>
                                    <li class="blog_post_meta_item"><a href="">Ajouter par:{{blog.community.grpName}} </a></li>

                          <li class="blog_post_meta_item"><a href="">Nombre de commentaire:{{blog.commentArticles|length}} </a></li>
   <li class="blog_post_meta_item"><a href="">Ajoutee:{{blog.DateAjout |date()}} </a></li>
             <li class="blog_post_meta_item">

                    {% set test = 'false' %}

                    {% set test2 = 'false' %}

 {% if is_granted('IS_AUTHENTICATED_FULLY') %}

 {% for b in blog.likes %}
                    {% set test2 = 'true' %}



                                 {% if b.id == app.user.id %}
                                
                                                    <form action="{{ path('remove_like') }}" method ="post">
                    
                                        <input type="hidden" value="{{blog.id}}" name="id">

                                  {{blog.likes|length}}   <button class="fa fa-thumbs-up " disabled  > Like </button>
                               {{blog.dislike|length}}       <button class="btn btn-outline-danger btn-sm "  > Dislike </button>

                    </form>
                    {% set test = 'true' %}
                    {% set test2 = 'true' %}


                                   {% endif %}
{% endfor %}

                                 {% if test == "false" and test2 == "true"  %}   
                 
         <form action="{{ path('add_like') }}" method ="post">
                    
                                        <input type="hidden" value="{{blog.id}}" name="id">

                                        {{blog.likes|length}}   <button class="fa fa-thumbs-up"  > Like </button>
                               {{blog.dislike|length}}       <button class="btn btn-outline-dark btn-sm " disabled  > Dislike </button>
                    </form>
                 {% endif %}
                                                
                                 {% if test2 == "false"  %}                    
                      <form action="{{ path('add_like') }}" method ="post">
                    
                                        <input type="hidden" value="{{blog.id}}" name="id">

    {{blog.likes|length}}   <button class="fa fa-thumbs-up "   > Like </button>
                               {{blog.dislike|length}}       <button class="btn btn-outline-danger btn-sm "  > Dislike </button>                    </form>
    {% endif %}

 {% endif %}





                                                                                         </li>
                                </ul>
                            </div>
                            <div class="blog_post_title"><a href="#">{{ blog.title }}</a></div>
                            <div class="blog_post_text">
                                <p>{{ blog.description }}</p>
                            </div>
                            <div class="blog_post_title"><a href="#">Commentaire</a></div>
                           

                            {% for b in blog.commentArticles %}

                            <div class="blog_post_text">
                            <form method="post" action="{{ path('comment_article_delete', {'id': b.id}) }}" onsubmit="return confirm('Vous voulez supprimer votre commentaire?');">

                                <p>{{ b.user.username }} : {{ b.contenu }} 
                                {% if is_granted('IS_AUTHENTICATED_FULLY') %}

                                 {% if b.user.id == app.user.id %}
                                 
                                     <button class="btn btn-outline-danger btn-sm"> supprimer </button>

    <input type="hidden" name="_method" value="DELETE">
        <input type="hidden" name="idb" value="{{b.blogs.id}}">

    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ b.id) }}">
</form>

                                                             {% endif %}
                                                             {% endif %}
                                 </p>

                            </div>

                            {% endfor %}

                        </div>



<form action="{{ path('comment_article_new') }}" method ="post">
                    
                    <input type="text" name="comment">
                                        <input type="hidden" value="{{blog.id}}" name="id">

                    <input type="submit"> 
                    </form>


                </div>
                <!-- Blog Sidebar -->


            </div>
        </div>
    </div>

  {% endblock %}
